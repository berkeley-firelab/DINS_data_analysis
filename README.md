# DINS Data Preparation

This repository contains scripts for data preprocessing and preparation, organized under the "data_pre-processing" workflow. Additionally, the Feature Importance and SHAP analysis scripts are located in the "FI_and_SHAP_final" directory.

## data

* `dins-2017-2022`: This is the original dataset containing string values.
* `WUI_fires`: This directory contains pre-processed and original datasets for five WUI fires with NaN values. 

## dins and WUI datasets dictionary

### Categorical Variables

`DAMAGE`, `ROOFCONSTRUCTION`, `EXTERIORSIDING`, `WINDOWPANE`, `EAVES`, `VENTSCREEN`, `DECK/PORCH ON GRADE`, `DECKPORCHELEVATED`, `PATIOCOVER`, `FENCE`, `VSD`

## Numerical Variables:

`Distance`, `YEARBUILT`, `ZIPCODE`, `EMBER`, `FLAME`

## `dins`

* `DAMAGE`: ['Inaccessible', 'No Damage', 'Affected (1-9%)', 'Minor (10-25%)', 'Major (26-50%)', 'Destroyed (>50%)']
* `ROOFCONSTRUCTION`: ['Unknown', 'Fire Resistant', 'Metal', 'Concrete', 'Tile', 'Asphalt', 'Other', 'Wood', 'Combustible']
* `EXTERIORSIDING`: ['Unknown', 'Metal', 'Stucco Brick Cement', 'Stucco/Brick/Cement', 'Ignition Resistant', 'Fire Resistant', 'Vinyl', 'Other', 'Combustible', 'Wood']
* `WINDOWPANE`: ['Unknown', No Windows', 'Single Pane', 'Multi Pane']
* `EAVES`: ['Unknown', 'Not Applicable', 'No Eaves', 'Unenclosed', â€˜'Enclosed']
* `VENTSCREEN`: ['Unknown', 'Screened', 'Mesh Screen <= 1/8"', 'Mesh Screen > 1/8"', 'Unscreened', 'No Vents']
* `DECK/PORCH ON GRADE`: ['Unknown', 'No Deck/Porch', 'Masonry/Concrete', 'Composite', 'Wood']
* `DECKPORCHELEVATED`: ['Unknown', 'No Deck/Porch', 'Masonry/Concrete', 'Composite', 'Wood']
* `PATIOCOVER (PATIOCOVERCARPORT)`: ['Unknown', 'No Patio Cover/Carport', 'Non Combustible', 'Combustible']
* `FENCE (FENCEATTACHEDTOSTRUCTURE)`:['Unknown', 'No Fence', 'Non Combustible', 'Combustible']
* `Distance`: Structure Separation Distance (SSD) in *feet*, Using the building footprints data set, the distance from one structure to its nearest neighboring structure is measured with the QGIS tools.
* `YEARBUILT`: Year that primary structure in parcel was constructed
* `ZIPCODE`: Zip Code

## `WUI fires`

In addition to the `dins` variables, we also have `VSD`, `EMBER`, and `FLAME` for our WUI fires:

* `VSD`: Vegetation Separation Distance or Defensible Space is the minimum distance measured from a structure to surrounding vegetation (Through an airborn LiDAR data for Sonoma County as well as Aerial/Street View Imagery). Zone 0= (0-5ft), Zone 1= (5-30ft), Zone 2= (30-100ft), and +100ft 

* `EMBER and FLAME`= Generated by the WUI model

## Adopted data processing

The steps for data preprocessing are as follows:

1. Separate the data into train and test cases with 20% going to the test set.
2. Design imputation strategies, train and apply them to the train set, and fit to the test set.
To enable the use of a variety of models:
    - Normalize the numerical variables
    - Conduct `OneHotEncoding` on categorical variables
4. Resample to make the representation of all classes equal to in the train set.
5. If necessary do a `PCA` conversion
6. Put all steps into a pipeline under one function

### Imputation strategies

The strategy differs for each type of `categorical` and `numerical` feature and even within each category

*DINS*: Adopted strategy for features with missing values in samples,

- `ROOFCONSTRUCTION`  has `82817` non-null objects: Nearest neighbor imputation.
- `EAVES` has `82741` non-null objects: Nearest neighbor imputation.
- `VENTSCREEN` has `82692` non-null objects: Nearest neighbor imputation.
- `EXTERIORSIDING` has`82800` non-null objects: Nearest neighbor imputation.
- `WINDOWPANE` has `82732` non-null objects: Nearest neighbor imputation.
- `DECKPORCHONGRADE` has `70291` non-null objects: Nearest neighbor imputation.
- `DECKPORCHELEVATED` has `70290` non-null objects: Nearest neighbor imputation.
- `PATIOCOVER` has `70286` non-null objects: Nearest neighbor imputation.
- `FENCE` has `70289` non-null objects: Nearest neighbor imputation.
- `YEARBUILT` has `53075` non-null objects: Nearest neighbor imputation.

*Wildfire cases*: Adopted strategy for features with missing values in samples,

- `ZIPCODE` has `15` non-null floats: Reverse geo-encoding can be used if this is useful. Potentially for future studies. 
- `ROOFCONSTR` has `19318`  non-null samples: Nearest neighbor imputation
- `EAVES` has `19318`  non-null samples: Nearest neighbor imputation
- `VENTSCREEN` has `19318`  non-null samples: Nearest neighbor imputation
- `EXTERIORSI` has `19318`  non-null samples: Nearest neighbor imputation
- `WINDOWPANE` has `19318`  non-null samples: Nearest neighbor imputation
- `DECKPORCHO` has `19318`  non-null samples: Nearest neighbor imputation
- `DECKPORCHE` has `19318`  non-null samples: Nearest neighbor imputation
- `PATIOCOVER` has `19318`  non-null samples: Nearest neighbor imputation
- `FENCEATTAC` has `19317`  non-null samples: Nearest neighbor imputation
- `YEARBUILT ` has `22501`  non-null samples: Nearest neighbor imputation or median
- `VSD` has `3504 ` non-null  samples: Aggregate (mean, median, etc)
- `EMBER` has `11549`  non-null samples: Aggregate (mean, median, etc) potentially with KNN
- `FLAME` has `14578`  non-null samples: Aggregate (mean, median, etc) potentially with KNN

## Workflow Types

Two types of workflows are provided:

* `ipyn`: Jupyter Notebook-based workflow.
* `py`: Python script-based workflow.
